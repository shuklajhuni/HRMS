{% extends 'base.html' %}

{% block title %}Employee Management - JSCode{% endblock %}

{% block extra_css %}
<style>
    /* 1. Force Equal Input Heights */
    input[type="text"], input[type="email"], select, .django-select-widget {
        height: 40px !important;
        padding: 8px 12px !important;
        border-radius: 4px !important;
        border: 1px solid #cbd5e1 !important;
        font-size: 0.9rem !important;
        width: 100% !important;
        box-sizing: border-box !important;
    }

    /* 2. Layout Containers */
    .dashboard-flex {
        display: flex;
        gap: 20px;
        align-items: stretch; /* Forces sidebar and form to be same height */
        margin-bottom: 30px;
    }

    .main-form-card {
        flex: 3;
        background: white;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        display: flex;
        flex-direction: column;
    }

    /* 3. Symmetric Grid for Equal Spacing */
    .equal-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px; /* Perfectly equal horizontal and vertical spacing */
        padding: 25px;
    }

    .full-width-column {
        grid-column: span 2;
    }

    .input-wrapper {
        display: flex;
        flex-direction: column;
        gap: 6px; /* Equal gap between label and input */
    }

    .label-style {
        font-size: 0.8rem;
        font-weight: 700;
        color: #475569;
    }
</style>
{% endblock %}

{% block content %}
    <div style="margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #e2e8f0;">
        <h2 style="font-size: 1.25rem; color: #000080; margin: 0; font-weight: 700;">ðŸ‘¤ Employee Management</h2>
    </div>

    {% if messages %}
        {% for message in messages %}
            <div style="padding: 10px 20px; margin-bottom: 20px; border-radius: 4px; font-size: 0.85rem; background: {% if message.tags == 'success' %}#d4edda; color: #155724;{% else %}#f8d7da; color: #721c24;{% endif %}; border: 1px solid rgba(0,0,0,0.05);">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="dashboard-flex">
            
            <div class="main-form-card">
                <div style="background: #000080; color: white; padding: 10px 20px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; border-radius: 7px 7px 0 0;">
                    Registration Form
                </div>
                
                <div class="equal-grid">
                    <div class="input-wrapper">
                        <label class="label-style">Employee Code</label>
                        {{ form.emp_code }}
                        {% if form.emp_code.errors %}<span style="color: #ef4444; font-size: 0.7rem;">{{ form.emp_code.errors.0 }}</span>{% endif %}
                    </div>

                    <div class="input-wrapper">
                        <label class="label-style">Full Name</label>
                        {{ form.name }}
                    </div>

                    <div class="input-wrapper">
                        <label class="label-style">Gender</label>
                        {{ form.gender }}
                    </div>

                    <div class="input-wrapper">
                        <label class="label-style">Department</label>
                        {{ form.department }}
                    </div>

                    <div class="input-wrapper full-width-column">
                        <label class="label-style">Official Email Address</label>
                        {{ form.official_email }}
                        {% if form.official_email.errors %}<span style="color: #ef4444; font-size: 0.7rem;">{{ form.official_email.errors.0 }}</span>{% endif %}
                    </div>
                </div>
                
                <div style="padding: 0 25px 25px 25px; margin-top: auto;">
                    <button type="submit" style="background: #2ecc71; color: white; border: none; padding: 12px; border-radius: 5px; font-weight: 700; font-size: 0.9rem; cursor: pointer; width: 100%;">
                        Save Employee Record
                    </button>
                </div>
            </div>

            <div style="flex: 0 0 240px; background: white; border: 1px solid #e2e8f0; border-radius: 8px; padding: 25px; text-align: center; display: flex; flex-direction: column; justify-content: center;">
                <h4 style="margin: 0 0 15px; font-size: 0.85rem; color: #1e293b; font-weight: 700;">Profile Photo</h4>
                
                <div id="photo-preview" style="width: 120px; height: 120px; background: #f8fafc; border: 1px dashed #cbd5e1; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; overflow: hidden;">
                    {% if object.profile_photo %}
                        <img src="{{ object.profile_photo.url }}" style="width: 100%; height: 100%; object-fit: cover;">
                    {% else %}
                        <span style="font-size: 40px; color: #94a3b8;">ðŸ‘¤</span>
                    {% endif %}
                </div>
                
                <div style="display:none">{{ form.profile_photo }}</div>
                <button type="button" onclick="document.getElementById('{{ form.profile_photo.id_for_label }}').click();" style="background: #475569; color: white; border: none; padding: 10px; border-radius: 5px; font-size: 0.75rem; font-weight: 600; cursor: pointer;">
                    Change Image
                </button>
            </div>
        </div>
    </form>

   <div style="background: white; border: 1px solid #e2e8f0; border-radius: 8px; overflow: hidden;">
        <div style="background: #f8fafc; padding: 10px 20px; border-bottom: 1px solid #e2e8f0; color: #000080; font-weight: 700; font-size: 0.85rem;">
            Employee logs
        </div>
        <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">

            <thead>

                <tr style="background: #000080; color: white;">

                    <th style="padding: 12px 15px; text-align: left;">Photo</th>

                    <th style="padding: 12px 15px; text-align: left;">Code</th>

                    <th style="padding: 12px 15px; text-align: left;">Name</th>

                    <th style="padding: 12px 15px; text-align: left;">Dept.</th>

                    <th style="padding: 12px 15px; text-align: left;">Actions</th>

                </tr>

            </thead>

            <tbody>

                {% for emp in employees %}

                <tr style="border-bottom: 1px solid #e2e8f0;">

                    <td style="padding: 10px 15px;">

                        {% if emp.profile_photo %}

                            <img src="{{ emp.profile_photo.url }}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">

                        {% else %}

                            <div style="width: 40px; height: 40px; border-radius: 50%; background: #f1f5f9; display: flex; align-items: center; justify-content: center; font-size: 20px;">ðŸ‘¤</div>

                        {% endif %}

                    </td>

                    <td style="padding: 12px 15px;"><strong>{{ emp.emp_code }}</strong></td>

                    <td style="padding: 12px 15px;">{{ emp.name }}</td>

                    <td style="padding: 12px 15px;">{{ emp.department }}</td>

                    <td style="padding: 12px 15px; display: flex; gap: 8px;">

                        <a href="{% url 'employee-edit' emp.id %}" style="text-decoration: none; padding: 5px 12px; border-radius: 4px; font-size: 0.75rem; font-weight: 600; background: #3b82f6; color: white;">Edit</a>

                        <form action="{% url 'employee-delete' emp.id %}" method="post">

                            {% csrf_token %}

                            <button type="submit" onclick="return confirm('Permanently delete?')" style="padding: 5px 12px; border-radius: 4px; font-size: 0.75rem; font-weight: 600; background: #ef4444; color: white; border: none; cursor: pointer;">Delete</button>

                        </form>

                    </td>

                </tr>

                {% endfor %}

            </tbody>

        </table>
    </div>
{% endblock %}

{% block extra_js %}
<script>
    const fileInput = document.getElementById('{{ form.profile_photo.id_for_label }}');
    const previewContainer = document.getElementById('photo-preview');

    fileInput.onchange = function() {
        if (this.files && this.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                previewContainer.innerHTML = `<img src="${e.target.result}" style="width:100%; height:100%; object-fit:cover;">`;
            }
            reader.readAsDataURL(this.files[0]);
        }
    };
</script>
{% endblock %}